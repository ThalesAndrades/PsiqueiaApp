{
  "name": "Release Preparation",
  "description": "PreparaÃ§Ã£o e validaÃ§Ã£o de releases",
  "trigger": {
    "push": {
      "branches": [
        "release/*"
      ]
    }
  },
  "environment": {
    "xcode": "15.2",
    "node": "18.x",
    "variables": [
      {
        "name": "NODE_ENV",
        "value": "production"
      },
      {
        "name": "CI",
        "value": "true"
      },
      {
        "name": "EXPO_PUBLIC_ENV",
        "value": "staging"
      }
    ]
  },
  "steps": [
    {
      "name": "Install Dependencies",
      "script": "set -e\necho \"ğŸ”§ Instalando dependÃªncias...\"\nnpm ci"
    },
    {
      "name": "Version Validation",
      "script": "set -e\necho \"ğŸ” Validando versÃ£o...\"\nnpm run version:check || echo \"âš ï¸ Version check nÃ£o configurado\"\nnpm run changelog:validate || echo \"âš ï¸ Changelog validation nÃ£o configurada\""
    },
    {
      "name": "Run All Tests",
      "script": "set -e\necho \"ğŸ§ª Executando todos os testes...\"\nnpm run test:all || npm test -- --coverage --watchAll=false\nnpm run lint\nnpm run type-check || echo \"âš ï¸ Type checking nÃ£o configurado\""
    },
    {
      "name": "Build Documentation",
      "script": "set -e\necho \"ğŸ“š Construindo documentaÃ§Ã£o...\"\nnpm run docs:build || echo \"âš ï¸ Build de documentaÃ§Ã£o nÃ£o configurado\""
    },
    {
      "name": "Generate iOS Project",
      "script": "set -e\necho \"ğŸ“± Gerando projeto iOS...\"\nnpx expo prebuild --platform ios --clean --no-install"
    },
    {
      "name": "Validate iOS Build",
      "script": "set -e\necho \"ğŸ” Validando build iOS...\"\ncd ios\npod install\nxcodebuild -workspace ios/PsiqueiaApp.xcworkspace \\\n  -scheme PsiqueiaApp \\\n  -configuration Release \\\n  -destination 'platform=iOS Simulator,name=iPhone 15' \\\n  build"
    }
  ]
}